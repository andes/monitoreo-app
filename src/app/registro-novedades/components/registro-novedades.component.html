<plex-layout main={{main}}>
    <plex-layout-main>
        <plex-title titulo={{title}} main>
            <plex-button label="Registrar Novedad" type="primary" (click)="nuevo()"></plex-button>
        </plex-title>
        <div class="d-flex justify-content-between align-items-end">
            <plex-text label="Filtrar: " name="name" [(ngModel)]="textoBuscar" class="w-100" (change)="loadData(false)">
            </plex-text>
        </div>
        <plex-scroll (change)="loadData(true)"></plex-scroll>
        <div *ngIf="listRegNovedades.length != 0;else mostrarVacio">
            <div class="col">
                <table class="table table-hover table-striped">
                    <thead>
                        <tr>
                            <td><strong>Número</strong></td>
                            <td><strong>Titulo</strong></td>
                            <td><strong>Fecha</strong></td>
                            <td><strong>Módulo</strong></td>
                            <td><strong>Estado</strong></td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let nov of listRegNovedades;index as i" (click)="verRegistro(nov)">
                            <td>{{i + 1}}</td>
                            <td>{{nov.titulo}}</td>
                            <td>{{nov.fecha | date: 'dd/MM/yyyy'}}</td>
                            <td>{{nov.modulo.nombre}}</td>
                            <td>
                                <plex-badge type="success" *ngIf="nov.activa">
                                    <plex-icon name="save"></plex-icon> Activa
                                </plex-badge>
                                <plex-badge type="danger" *ngIf="!nov.activa">
                                    <plex-icon name="save"></plex-icon> Inactiva
                                </plex-badge>
                            </td>

                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <ng-template #mostrarVacio>
            <div class="sinDatos">
                <label>No hay datos para mostrar</label>
            </div>
        </ng-template>
    </plex-layout-main>

    <plex-layout-sidebar>
        <plex-title titulo={{titleABM}} size="sm" main>
            <plex-button label="Cancelar" type="danger" (click)="cerrarSidebar()" size="sm"></plex-button>
            <plex-button class="float-right" size="sm" type="success" label="Guardar" (click)="creaModificaNovedad()"
                         [validateForm]="formulario" [disabled]="!formulario.form.valid">
            </plex-button>
        </plex-title>
        <br>
        <form #formulario="ngForm">
            <div class="align-items-end" justify>
                <plex-text class="w-100 mr-4" required label="titulo" [(ngModel)]="regNov.titulo" name="titulo">
                </plex-text>
                <plex-bool label="Activa" [(ngModel)]="regNov.activa" type="slide" name="activo" class="float-left">
                </plex-bool>
            </div>
            <div justify>
                <plex-select class="w-50" *ngIf="listModulos" required [(ngModel)]="regNov.modulo" name="select"
                             [data]="listModulos" labelField="nombre" label="Seleccione Módulo" idField="_id">
                </plex-select>
                <plex-datetime label="fecha" [(ngModel)]="regNov.fecha" name="fecha" type="date" required>
                </plex-datetime>
            </div>
            <plex-text label="descripcion" [(ngModel)]="regNov.descripcion" name="descripcion" html="true" required>
            </plex-text>

            <plex-title justify titulo="Cargar Imagen" size="sm" class="mt-4">
                <input type="file" (change)="changeListener($event)" style="display:none;" #upload>
                <ng-container *ngIf="!waiting">
                    <plex-button type="primary" icon="image-plus" class="btn-sm" title="Elegir Imagen"
                                 (click)="upload.click()">
                        <!-- <plex-icon name=""></plex-icon> -->
                    </plex-button>
                </ng-container>
            </plex-title>
            <span *ngIf="waiting">
                <plex-loader class="app-waiting" type="ball-pulse-sync"></plex-loader>
                <plex-button type="danger" class="btn-sm" label="Cancelar" (click)="cancelarAdjunto()">
                </plex-button>
            </span>

            <div class="row">
                <div class="image-container hr-inline-group" *ngIf="fotos && fileToken">
                    <ng-container *ngFor="let doc of fotos; let i = index">
                        <a (click)="activaLightbox(i)">
                            <div class="image hover">
                                <img [src]="createUrl(doc)" alt="">
                                <div class="x-mark" (click)="imageRemoved(doc)"><span class="close"></span>
                                </div>
                            </div>
                        </a>
                        <div (click)="lightbox = false" *ngIf="i === indice && lightbox"
                             [ngClass]="{'lightbox': i === indice && lightbox }" class="hover">
                            <i (click)=imagenPrevia(i) class="mdi mdi-chevron-double-left previous parpadeo"></i>
                            <img [src]="createUrl(doc)" alt="">
                            <i (click)=imagenSiguiente(i) class="mdi mdi-chevron-double-right next parpadeo"></i>
                        </div>
                    </ng-container>
                </div>
            </div>
        </form>
    </plex-layout-sidebar>
</plex-layout>